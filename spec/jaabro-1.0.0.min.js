/* jaabro-1.0.0.min.js | MIT license: http://github.com/jmettraux/jaabro/LICENSE.txt */var Jaabro={VERSION:"1.0.0",Input:{}};Jaabro.Input.slice=function(a,b){if(void 0===a||null===a)a=this.offset;return void 0===b?this.string.slice(a):this.string.slice(a,a+b)};Jaabro.Input.match=function(a){if("string"===typeof a){var b=a.length;return this.slice(this.offset,b)===a?b:-1}a=this.slice(this.offset).match(a);return null!==a&&0==a.index?a[0].length:-1};Jaabro.Node={};Jaabro.Node.prune=function(){var a=[];this.children.forEach(function(b){1===b.result&&a.push(b)});this.children=a};
Jaabro.Node.string=function(){return this.input.slice(this.offset,this.length)};Jaabro.Node.lookup=function(a){if(this.name===a)return this;for(var b=0,c=this.children.length;b<c;b++){var e=this.children[b].lookup(a);if(e)return e}return null};Jaabro.Node.gather=function(a,b){var c=b||[];this.name===a?c.push(this):this.children.forEach(function(b){b.gather(a,c)});return c};
Jaabro.Node.toArray=function(a){var b=null;if(1===this.result&&0===this.children.length)b=this.string();else for(var b=[],c=0,e=this.children.length;c<e;c++)b.push(this.children[c].toArray(a));return[this.name,this.result,this.offset,this.length,this.parter,b]};
Jaabro.Node.toString=function(a,b){var c=a||0,e=b||[];0<c&&e.push("\n");for(var f=0;f<c;f++)e.push("  ");e.push(this.result," ",JSON.stringify(this.name)," ");e.push(this.offset,",",this.length);1===this.result&&0===this.children.length&&e.push(" ",JSON.stringify(this.string()));this.children.forEach(function(a){a.toString(c+1,e)});return 0==c?e.join(""):null};Jaabro.str=function(a,b,c){a=this.makeNode(a,b,"string"===typeof c?"str":"rex");c=b.match(c);-1<c&&(a.result=1,a.length=c,b.offset+=c);return a};
Jaabro.rex=Jaabro.str;Jaabro.alt=function(a,b,c){for(var e=[],f=2,g=arguments.length;f<g;f++)e.push(arguments[f]);g=e[e.length-1];f=!1;if(!0===g||!1===g)e.pop(),f=g;for(var g=b.offset,k=this.makeNode(a,b,f?"altg":"alt"),h=null;;){var l=e.shift();if(!l)break;l=l(b);k.children.push(l);b.offset=g;if(f)1===l.result&&l.length>(h?h.length:-1)&&(h&&(h.result=0),h=l);else if(h=l,1===l.result)break}h&&1===h.result&&(k.result=1,k.length=h.length,b.offset=g+k.length);b.options.prune&&k.prune();return k};
Jaabro.altg=function(a,b,c){for(var e=[],f=0,g=arguments.length;f<g;f++)e.push(arguments[f]);e.push(!0);return this.alt.apply(this,e)};Jaabro.qmark=function(){return[0,1]};Jaabro.star=function(){return[0,0]};Jaabro.plus=function(){return[1,0]};Jaabro.qmark.jname="qmark";Jaabro.qmark.quantifier=!0;Jaabro.star.jname="star";Jaabro.star.quantifier=!0;Jaabro.plus.jname="plus";Jaabro.plus.quantifier=!0;
Jaabro.toQuantifier=function(a){return"?"===a?this.qmark:"*"===a?this.star:"+"===a?this.plus:a&&a.quantifier?a:null};Jaabro.quantify=function(a){return(a=this.toQuantifier(a))?a():!1};
Jaabro.seq=function(a,b,c){for(var e=b.offset,f=this.makeNode(a,b,"seq"),g=null,k=[],h=2,l=arguments.length;h<l;h++)k.push(arguments[h]);for(;;){h=k.shift();if(!h)break;if(this.toQuantifier(h))throw Error("lonely quantifier "+h.jname);(g=this.quantify(k[0]))?(k.shift(),g=this.rep(null,b,h,g[0],g[1]),f.children=f.children.concat(g.children)):(g=h(b),f.children.push(g));if(1!==g.result)break}1===g.result?(f.result=1,f.length=b.offset-e):b.offset=e;return f};
Jaabro.rep=function(a,b,c,e,f){if(null===e||void 0===e||0>e)e=0;if(null===f||void 0===f||0>f)f=0;var g=b.offset;a=this.makeNode(a,b,"rep");for(var k=0;;){var h=c(b);a.children.push(h);if(1!==h.result)break;k+=1;if(0<f&&k===f)break}k>=e&&(1>f||k<=f)?(a.result=1,a.length=b.offset-g):b.offset=g;b.options.prune&&a.prune();return a};Jaabro.ren=function(a,b,c){b=c(b);b.name=a;return b};
Jaabro.all=function(a,b,c){var e=b.offset,f=b.string.length-e;a=this.makeNode(a,b,"all");c=c(b);a.children.push(c);c.length<f?b.offset=e:(a.result=1,a.length=f);return a};
Jaabro.eseq=function(a,b,c,e,f,g){var k=!1;void 0===f&&void 0===g&&(k=!0,f=e,e=c,c=null);var h=b.offset;a=this.makeNode(a,b,k?"jseq":"eseq");a.result=1;var l=null;c&&(l=c(b),a.children.push(l),1!==l.result&&(a.result=0));if(1===a.result){c=1;for(var m=0;;){c=(c+1)%2;l=(0==c?e:f)(b);a.children.push(l);if(1!==l.result)break;m+=1}k&&1>m&&(a.result=0)}1===a.result&&g&&(l=g(b),a.children.push(l),1!==l.result&&(a.result=0));1==a.result?a.length=b.offset-h:b.offset=h;b.options.prune&&a.prune();return a};
Jaabro.jseq=Jaabro.eseq;
Jaabro.make=function(a){var b=Object.create(Jaabro),c=a.toString();"all alt altg eseq jseq ren rep rex seq str".split(" ").forEach(function(a){c=c.replace(new RegExp(" +"+a+"\\(","g")," Jaabro."+a+"(")});c=c.slice(0,c.lastIndexOf("}"))+'var rewrite;rewrite= rewrite ||function(t) { return eval("rewrite_" + t.name)(t); };try { eval("root"); } catch(err) {throw new Error("missing function root() parser");};return [ root, rewrite ];}';a=eval("("+c+")");a=a(b);b.root=a[0];b.rewrite=a[1];return b};
Jaabro.makeParser=Jaabro.make;Jaabro.makeInput=function(a,b){var c=Object.create(Jaabro.Input);c.string=a;c.offset=0;c.options=b||{};return c};Jaabro.makeNode=function(a,b,c){var e=Object.create(Jaabro.Node);e.name=a;e.result=0;e.input=b;e.offset=b.offset;e.length=0;e.parter=c;e.children=[];return e};
Jaabro.parse=function(a,b){b=b||{};d=parseInt(b.debug,10)||0;0<d&&(b.rewrite=!1);1<d&&(b.all=!1);2<d&&(b.prune=!1);b.hasOwnProperty("prune")||(b.prune=!0);var c=null,c=!1===b.all?this.root(this.makeInput(a,b)):Jaabro.all(null,this.makeInput(a,b),this.root);if(0!=b.prune&&1!==c.result)return null;"all"===c.parter&&(c=c.children[0]);return!1!==b.rewrite?this.rewrite(c):c};
/* minified from commit 86eae30 on Tue Oct  6 06:57:18 JST 2015 */
